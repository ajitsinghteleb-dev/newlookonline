/**
 * CORE PHILOSOPHY
 * This ruleset secures an automated content aggregation portal. The core security
 * model is to make content collections (news, jobs, tenders) globally readable
 * by any client, while prohibiting direct client writes. Data is added by a
 * trusted backend service. Ad creation is an exception, allowed by any authenticated
 * user, but managed only by an admin.
 *
 * KEY SECURITY DECISIONS
 * - Public Read, Backend Write: Content collections are public-read. All
 *   client-side write operations are denied (`allow write: if false;`) to
 *   ensure data integrity.
 * - Admin by Email: Access to administrative functions is restricted to a
 *   specific email address ('ajitsingh0110@gmail.com'). This is a simple and
 *   direct way to manage a single administrator without custom claims.
 * - Authenticated Ad Submission: Any authenticated user can create an ad request,
 *   which is then placed in a moderation queue readable only by the admin.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // -------------------------------------------------------------------------
    // Helper Functions
    // -------------------------------------------------------------------------

    /**
     * Checks if the authenticated user's email matches the designated admin email.
     * This is the primary mechanism for role-based access control in this app.
     */
    function isAdmin() {
      return request.auth != null && request.auth.token.email == 'ajitsingh0110@gmail.com';
    }

    // -------------------------------------------------------------------------
    // Content Collections (Public Read-Only)
    // -------------------------------------------------------------------------

    /**
     * @description Allows public read access to news articles. Writes are disabled.
     * @path /news/{newsId}
     */
    match /news/{newsId} {
      allow get: if true;
      allow list: if true;
      allow write: if false;
    }

    /**
     * @description Allows public read access to job postings. Writes are disabled.
     * @path /jobs/{jobId}
     */
    match /jobs/{jobId} {
      allow get: if true;
      allow list: if true;
      allow write: if false;
    }

    /**
     * @description Allows public read access to tenders. Writes are disabled.
     * @path /tenders/{tenderId}
     */
    match /tenders/{tenderId} {
      allow get: if true;
      allow list: if true;
      allow write: if false;
    }

    // -------------------------------------------------------------------------
    // Administrative Collections
    // -------------------------------------------------------------------------

    /**
     * @description Manages ad requests. Allows any authenticated user to create
     *   an ad, but only the admin can view, approve, or delete them.
     * @path /ads/{adId}
     */
    match /ads/{adId} {
        allow get: if isAdmin();
        allow list: if isAdmin();
        allow create: if request.auth != null;
        allow update: if isAdmin();
        allow delete: if isAdmin();
    }
  }
}
